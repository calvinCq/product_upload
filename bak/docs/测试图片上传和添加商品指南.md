# 微信小店图片上传和添加商品测试指南

## 概述

本文档提供了完整的测试流程，帮助您验证微信小店API的图片上传和商品添加功能。按照本指南操作，您可以快速完成测试并确保功能正常。

## 测试前准备

### 1. 环境检查

- **Python环境**：确保已安装Python 3.6或更高版本
- **依赖包**：执行以下命令安装所需依赖
  ```
  pip install requests python-dotenv
  ```
- **网络连接**：确保网络通畅，可以访问微信API服务器

### 2. 配置文件检查

确保 `wechat_api_config.json` 文件中的配置信息正确：

```json
{
    "appid": "您的AppID",
    "appsecret": "您的AppSecret",
    "api_base_url": "https://api.weixin.qq.com",
    "timeout": 30,
    "api_paths": {
        "upload_image": "/channels/ec/img/upload",
        "add_product": "/channels/ec/product/add"
    }
}
```

### 3. 测试资源准备

- **测试图片**：准备1-3张符合微信小店要求的商品图片
  - 格式：JPG、PNG等常见格式
  - 尺寸：建议主图800x800像素
  - 大小：不超过1MB

## 测试工具使用说明

### 1. 测试脚本介绍

我们提供了 `test_image_and_product.py` 脚本，这是一个交互式测试工具，可以测试：
- 图片上传功能
- 传统微信小店商品添加功能
- 视频号小店商品添加功能

### 2. 运行测试脚本

1. 打开命令行终端
2. 切换到项目目录
   ```
   cd c:\Users\EDY\Documents\trae_projects\upload_product
   ```
3. 运行测试脚本
   ```
   python test_image_and_product.py
   ```

### 3. 测试流程引导

脚本运行后，您将看到以下交互式引导：

#### 3.1 图片上传测试

```
请输入要上传的图片路径 (直接回车跳过): 
```

- 输入本地图片的完整路径，如 `C:\Users\EDY\Pictures\product.jpg`
- 可多次输入不同图片路径，完成后直接按回车继续
- 如果不提供图片，将使用示例URL进行测试

#### 3.2 选择测试类型

```
选择测试类型:
1. 传统微信小店商品
2. 视频号小店商品
请输入选择 (1/2，默认1): 
```

- 输入 `1` 测试传统微信小店商品
- 输入 `2` 测试视频号小店商品
- 直接回车默认选择1

#### 3.3 确认上传

脚本将显示准备的商品数据，并询问是否继续上传：

```
是否继续上传商品？(y/n，默认n): 
```

- 输入 `y` 继续上传测试
- 输入 `n` 或直接回车取消测试

## 测试数据说明

### 1. 示例商品数据

我们提供了 `test_data/example_product.json` 文件，包含两种格式的商品数据：

- `traditional_shop_product`：传统微信小店商品格式
- `video_shop_product`：视频号小店商品格式

您可以参考这些格式准备自己的商品数据。

### 2. 商品字段说明

#### 传统微信小店必填字段：

- **product_id**：商品ID（唯一标识）
- **product_name**：商品名称
- **category_id**：商品分类ID
- **main_image**：商品主图URL
- **image_list**：商品图片列表
- **price**：商品价格（单位：分）
- **original_price**：商品原价（单位：分）
- **product_desc**：商品描述
- **sku_list**：SKU列表
- **attributes**：商品属性
- **product_status**：商品状态（0=下架，1=上架）

#### 视频号小店必填字段：

- **title**：商品标题
- **desc**：商品描述
- **category_id1/category_id2/category_id3**：三级分类ID
- **sku_list**：SKU列表
- **head_imgs**：商品图片列表

## 测试结果分析

### 1. 图片上传结果

成功上传图片后，脚本会返回：
```
图片上传成功! 图片URL: https://mmbiz.qlogo.cn/...
```

如果上传失败，将显示错误信息：
```
图片上传失败: {错误详情}
```

### 2. 商品上传结果

成功上传商品后，脚本会返回：
```
商品上传成功! 商品ID: {商品ID}
```

如果上传失败，将显示错误信息：
```
商品上传失败: {错误信息}
```

## 常见问题处理

### 1. AppID或AppSecret错误

- 检查 `wechat_api_config.json` 中的配置是否正确
- 确保微信公众号已开通微信小店功能

### 2. 类目ID无效

- 参考 `wechat_shop_category_examples.json` 中的类目ID
- 确保使用正确层级的类目ID

### 3. 图片上传失败

- 检查图片格式是否正确
- 确保图片大小不超过1MB
- 检查网络连接是否正常

### 4. 商品上传失败

- 检查必填字段是否完整
- 确保商品描述符合要求（至少10个字符）
- 检查SKU数据格式是否正确

## 注意事项

1. 测试环境建议使用下架状态的商品（product_status=0 或 listing=0），避免影响实际店铺
2. API调用有频率限制，建议添加适当的请求间隔
3. 图片内容应符合微信平台的内容规范
4. 商品数据必须符合微信小店的规范要求
5. 详细测试日志会保存在当前目录下，文件名格式为 `test_时间戳.log`

## 进阶使用

如果您需要批量测试或自定义测试流程，可以参考以下文件：

- `product_uploader.py`：提供批量上传商品的功能
- `wechat_shop_api.py`：包含所有API调用的底层实现

---

**文档版本**: v1.0
**更新日期**: 2023-10-30