# 教育培训商品自动生成与上传系统 - 重构对齐文档

## 原始需求

用户要求重构系统，避免硬编码测试数据（如`create_test_client_data`函数中的固定课程信息），实现从输入读取数据、生成图片和标题、组装商品上传数据并完成商品添加等动作，并要求重构代码以梳理架构和配置。

## 边界确认

### 明确任务范围

1. **输入数据读取**：重构系统以支持从文件或命令行参数读取客户数据，而不是使用硬编码的测试数据
2. **内容生成**：保留现有的AI生成功能（商品标题、描述、图片生成等）
3. **商品数据组装**：正确组装符合微信小店API要求的商品数据结构
4. **商品上传**：集成现有的微信小店商品上传功能
5. **架构梳理**：优化代码结构，提高模块间的独立性和可维护性
6. **配置管理**：改进配置管理机制，支持灵活的配置选项

### 明确排除范围

1. 不改变系统的核心功能（文案生成、图片生成、商品上传）
2. 不修改现有的API调用逻辑（如钱多多API、微信小店API的调用方式）
3. 不添加新的生成模式或数据源（如不从数据库读取数据）

## 需求理解

### 对现有项目的理解

1. **系统架构**：
   - 系统采用模块化设计，包含配置管理、商品生成、图片生成、描述生成、商品上传等多个模块
   - `auto_product_manager.py`作为主控程序，提供命令行接口和流程控制
   - `config_manager.py`负责配置管理，支持从配置文件、环境变量和.env文件加载配置
   - `test_full_system.py`作为测试脚本，但目前包含硬编码的测试数据

2. **数据流程**：
   - 客户数据 → 商品信息生成 → 图片生成 → 商品数据组装 → 微信小店上传
   - 目前测试脚本中客户数据是硬编码的，需要改为从文件读取

3. **现有问题**：
   - 测试数据硬编码在`create_test_client_data`函数中
   - 系统架构需要更清晰的模块化和接口定义
   - 配置管理和数据流程需要优化

## 疑问澄清

以下是在重构过程中可能需要澄清的问题：

1. **输入数据格式**：是否需要支持多种格式的客户数据输入（如JSON、CSV等）？
2. **错误处理策略**：对于输入数据格式错误、生成失败等情况，系统应采取什么处理策略？
3. **日志记录级别**：重构后的系统需要什么级别的日志记录？
4. **临时文件管理**：如何管理生成过程中的临时文件（如图片）？
5. **配置文件结构**：是否需要调整现有的配置文件结构？

基于现有代码和用户需求，我将暂时做出以下假设：

1. **输入数据格式**：优先支持JSON格式的客户数据文件，这与现有系统的数据结构最为匹配
2. **错误处理策略**：采用异常捕获和日志记录的方式，对于关键错误直接终止流程
3. **日志记录级别**：维持现有INFO级别的日志记录，但增加更详细的模块间调用日志
4. **临时文件管理**：使用配置中指定的临时目录，在流程结束后可选清理
5. **配置文件结构**：保留现有配置文件结构，但优化配置加载逻辑

以上假设在实现过程中如有冲突，将根据代码实际情况和用户反馈进行调整。